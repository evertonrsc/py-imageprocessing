# Image Processing

[![PyPI - Python Version](https://img.shields.io/pypi/pyversions/3)](https://www.python.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
![Build](https://img.shields.io/badge/build-manual-lightgrey)
[![PyPI - Python Version](https://img.shields.io/badge/doc-pydoc-yellow)](./doc/index.html)

This repository features an image processing program that applies grayscale transformation to batches of images. These images are retrieved from a list of URLs pointing to public domain images available on the Web. The program downloads each image and converts it to grayscale. In the current version, the list of image URLs is generated by a lightweight generative artificial intelligence (AI) model.

---

## üìÇ Repository Structure

This repository is structured as follows:

```
.
‚îú‚îÄ‚îÄ doc/               # Documentation
‚îú‚îÄ‚îÄ src/               # Source code
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py         # Source file to serve to pdoc to generate a landing page for the documentation
‚îÇ   ‚îú‚îÄ‚îÄ imageprocessing.py  # Program to process images
‚îî‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ requirements.txt        # List of required packages
```

---

## üíª Getting Started

### üìã Prerequisites

[Python 3+](https://www.python.org) must be installed on the development environment to execute the program. Additionally, the [`requirements.txt`](requirements.txt) file lists the external packages required for this project:

| Package                                                   | Used version |
|:----------------------------------------------------------|:------------:|
| [requests](https://pypi.org/project/requests/)            |  2.32.5      |
| [opencv-python](https://pypi.org/project/opencv-python/)  |  4.12.0.88   |
| [google-genai](https://pypi.org/project/google-genai/)    |  1.39.1      |
| [pdoc](https://pypi.org/project/pdoc/)                    |  15.0.4      |

These packages require creating and using a [*virtual environment*](https://packaging.python.org/en/latest/tutorials/installing-packages/#creating-and-using-virtual-environments). A virtual environment allows Python packages to be installed in an isolated location for a particular application, rather than being installed system-wide as a measure of safety. The following command creates a virtual environment with the [`venv`](https://docs.python.org/3/library/venv.html) tool:

```bash
python3 -m venv runtime
```

This command creates a directory named `runtime` (the directory name is free of choice) at the local directory. The next step is to activate the virtual environment with the following command:

```bash
source runtime/bin/activate
```

From now on, the virtual environment will be used to install packages and running the program. The following command installs the required packages:

```bash
pip3 install -r requirements.txt
```

### ü§ñ Integration with Google Gemini

The current implementation of this project utilizes [Google Gemini 2.5 Flash-Lite](https://ai.google.dev/gemini-api/docs/models) as the IA model to generate the list of image URLs. The integration with Google Gemini is done via the [Gemini API](https://ai.google.dev/api), more precisely using the [Google GenAI SDK](https://ai.google.dev/gemini-api/docs/libraries) available for Python to abstract calls to the methods defined in the API.

Interacting with the Gemini API requires an [API key](https://ai.google.dev/gemini-api/docs/api-key). In the current implementation, the API key is [explicitly provided](https://ai.google.dev/gemini-api/docs/api-key#provide-api-key-explicitly) from a file. A personal, work, or school Google account is needed to create a project and an API key via [Google AI Studio](https://aistudio.google.com/app/api-keys).

The `generate_image_urls` function generates the list of image URLs. It uses two prompts submitted to Google Gemini via a client object that manages the interactions with the models. The first one requests the generation of image URLs:

```
Generate {numimages} public domain image URLs (either JPEG or PNG format) from trusted 
public domain image repositories. The URL must directly point to a valid image file 
ending with .jpg or .png and the file size must be less than 200 KB. Provide the final 
image URLs in plain text.
```

However, there is no guarantee that this prompt generates only the list of image URLs. To circumvent this issue, a second prompt is used to retrieve only the list of URLs from the output of the first prompt:

```
Extract all URLs from the following contents into a plain text list. Each URL must be 
on a new line. These are the contents: {output of the first prompt}
```

### ‚òëÔ∏è URL validity check

To avoid generating a URL to an image that is not directly accessible (e.g., image not found, redirecting to another page where the image is posted, etc.), an HTTP GET request is done for each generated URL. In case of the URL is inaccessible, another URL is generated. This is done until reaching the number of URLs defined for the program.

### ‚ñ∂Ô∏è Running the program

The program must be run from the virtual environment previously created with the number of images to process given through a command-line argument. In the following example, a set of five images will be processed:

```bash
python3 imageprocessing.py 5
```

The downloaded images are saved into the `images` directory and their grayscale versions into the `gs-images` directory.

### üóíÔ∏è Generating documentation

The generation and visualization of documentation is provided by [`pdoc`](https://pdoc.dev). The following command (also run in the virtual environment previously created) renders documentation as HTML pages:

```bash
pdoc ./src -o ./doc
```

The command will generate documentation for all source code files within the [`src`](src) directory into the [`doc`](doc) directory. It is also possible to render documentation live with the command

```bash
pdoc ./src
```

The command will result in opening a window in the browser running `pdoc` at a localhost server. In this case, the documentation pages will be automatically reloaded whenever changes are made to the source code.

---

## ü§ù Contributing

Contributions are welcome! Fork this repository and submit a pull request üöÄ

---

## üìú License

This project is licensed under the [MIT License](LICENSE).
